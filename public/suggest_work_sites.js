// Generated by LiveScript 1.4.0
(function(){
  var root, getFieldsFromExtension, domain_matcher, urlToDomain, isWorkUrl;
  root = typeof exports != 'undefined' && exports !== null ? exports : this;
  getFieldsFromExtension = function(fields_list, callback){
    return once_available('#autosurvey_content_script_loaded', function(){
      return sendExtension('requestfields', {
        fieldnames: fields_list,
        pagename: 'something'
      }, function(response){
        return sendExtension('requestfields', {
          fieldnames: fields_list,
          pagename: 'something'
        }, function(response){
          return callback(response);
        });
      });
    });
  };
  domain_matcher = new RegExp('://(.[^/]+)(.*)');
  urlToDomain = function(url){
    var domain_matches;
    domain_matches = url.match(domain_matcher);
    if (domain_matches == null || domain_matches.length < 2) {
      return '';
    }
    return domain_matches[1];
  };
  isWorkUrl = function(url, classifications){
    var domain;
    domain = urlToDomain(url);
    if (root.classifications[domain] == null) {
      return false;
    }
    if (root.classifications[domain] === 'work') {
      return true;
    }
    return false;
  };
  document.addEventListener('DOMContentLoaded', function(){
    return getFieldsFromExtension(['chrome_history_pages_past_24_hours'], function(data){
      return $.get('/classifications.json', function(classifications){
        var sites_visited, work_sites_visited, res$, i$, len$, x;
        root.classifications = classifications;
        console.log('classifications are');
        console.log(classifications);
        sites_visited = data['chrome_history_pages_past_24_hours'];
        sites_visited.sort(function(a, b){
          return b.lastVisitTime - a.lastVisitTime;
        });
        console.log('sites visited are');
        console.log(sites_visited);
        res$ = [];
        for (i$ = 0, len$ = sites_visited.length; i$ < len$; ++i$) {
          x = sites_visited[i$];
          if (isWorkUrl(x.url)) {
            res$.push(x);
          }
        }
        work_sites_visited = res$;
        console.log('work sites visited are');
        console.log(work_sites_visited);
        return document.querySelector('#rawdata').innerText = JSON.stringify(work_sites_visited);
      });
    });
  });
}).call(this);
